<!DOCTYPE html>
<html lang="pt" prefix="og: https://ogp.me/ns#">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Amo-Te Maria (Original)</title>
  <meta name="description" content="Vers√£o original do contador de dias e mem√≥rias." />
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <link rel="stylesheet" href="style.css" />
  <meta property="og:title" content="Amo-Te Maria" />
  <meta property="og:description" content="Dias juntos e mem√≥rias especiais." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="assets/images/IMG_2714.jpg" />
  <style>
    /* Estilo do pintainho (duck-counter) - flutuante no canto direito */
    .duck-counter {
      position: fixed;
      right: 16px;
      bottom: 16px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      background: #fff;
      color: #333;
      border: 1px solid #ffd7e2;
      border-radius: 999px;
      box-shadow: 0 8px 22px rgba(200,58,111,.18);
      cursor: pointer;
      user-select: none;
      z-index: 9999;
      font-weight: 700;
      font-size: 15px;
      -webkit-tap-highlight-color: transparent;
    }
    .duck-counter:focus-visible {
      outline: 3px solid rgba(255,107,143,.35);
      outline-offset: 2px;
    }
    .duck-counter:active { transform: translateY(1px); }
    .duck-emoji { font-size: 20px; line-height: 1; }
    .duck-count { min-width: 1.5ch; text-align: right; color: #c83a6f; }

    @media (max-width: 480px) {
      .duck-counter { right: 12px; bottom: 12px; padding: 9px 11px; font-size: 14px; }
      .duck-emoji { font-size: 19px; }
    }

    body {
      position: relative;
      overflow-x: hidden;
    }
  </style>
</head>
<body>

  <!-- Container para anima√ß√£o de cora√ß√µes -->
  <div class="hearts-explosion" id="heartsContainer"></div>
  
  <noscript><div style="background:#fff3f7;border:2px solid #ff6f91;padding:10px;border-radius:8px;max-width:400px;margin:10px auto;font-family:Arial,sans-serif;">Este site funciona melhor com JavaScript ativo ‚ù§Ô∏è</div></noscript>
  <header>
    <h1>Dias Juntos <span aria-hidden="true">‚ù§Ô∏è</span></h1>
  </header>
  <main class="container">
    <div class="center-image-container">
      <!-- Carrossel -->
      <div class="carousel" role="region" aria-label="Carrossel de fotos" aria-live="polite" id="dynamic-carousel">
        <!-- imagens ser√£o inseridas por script -->
      </div>
    </div>
    <div class="counter-container">
      <div class="timer" role="timer" aria-live="off">
        <!-- manter n√∫mero + label juntos; permitir quebra entre pares -->
        <span id="days">00</span>&nbsp;dias 
        <span id="hours">00</span>&nbsp;hrs 
        <span id="minutes">00</span>&nbsp;mins 
        <span id="seconds">00</span>&nbsp;secs
      </div>
    </div>
  </main>

  <section class="special-dates">
    <h2>Datas que fa√ßo quest√£o de lembrar</h2>
    <div class="dates-container">
      <!-- Ordenadas cronologicamente ao longo do ano -->
      <div class="date-card" data-date="06-29">
        <div class="date-number">29</div>
        <div class="date-month">Junho</div>
        <div class="date-description">Dia que nos conhecemos</div>
      </div>
      <div class="date-card" data-date="07-02">
        <div class="date-number">02</div>
        <div class="date-month">Julho</div>
        <div class="date-description">Primeiro beijo ‚Äî 14:55</div>
      </div>
      <div class="date-card" data-date="09-15">
        <div class="date-number">15</div>
        <div class="date-month">Setembro</div>
        <div class="date-description">Anivers√°rio do Ivan</div>
      </div>
      <div class="date-card" data-date="10-18">
        <div class="date-number">18</div>
        <div class="date-month">Outubro</div>
        <div class="date-description">Anivers√°rio da Princesa</div>
      </div>
      <div class="date-card" data-date="12-26">
        <div class="date-number">26</div>
        <div class="date-month">Dezembro</div>
        <div class="date-description">Dia do pedido de namoro</div>
      </div>
    </div>

    <div class="duck-calendar-wrap">
    <div class="duck-calendar" aria-label="Calend√°rio dos pintainhos">
      <h3>Calend√°rio dos pintainhos</h3>
      <div class="duck-cal-header" role="group" aria-label="Navega√ß√£o do calend√°rio">
        <button type="button" class="duck-cal-btn" id="duck-cal-prev" aria-label="M√™s anterior">‚Äπ</button>
        <div id="duck-cal-title" class="duck-cal-title" aria-live="polite"></div>
        <button type="button" class="duck-cal-btn" id="duck-cal-next" aria-label="M√™s seguinte">‚Ä∫</button>
      </div>
      <div class="duck-cal-weekdays" aria-hidden="true">
        <span>Seg</span><span>Ter</span><span>Qua</span><span>Qui</span><span>Sex</span><span>S√°b</span><span>Dom</span>
      </div>
      <div id="duck-cal-grid" class="duck-cal-grid" role="grid" aria-label="Dias com pintainhos"></div>
      <div class="duck-cal-legend"><span class="duck-cal-dot" aria-hidden="true"></span> Quantos pintainhos por dia</div>
    </div>
    </div>
  </section>
  <section class="digital-gift">
    <!-- Bot√£o vis√≠vel/clic√°vel -->
    <div id="digital-gift-btn"
         class="digital-gift-title clickable-title"
         role="button"
         tabindex="0">
      Amo-te Muito Marta/Maria‚ù§Ô∏è
    </div>
  </section>

  <!-- Inserir overlay/sequence antes do container das p√°ginas de amor -->
  <div id="love-sequence-overlay" class="overlay hidden" role="dialog" aria-modal="true" aria-label="Sequ√™ncia de amor">
    <div class="overlay-content">
      <div id="seq-text" class="seq-text" aria-live="polite"></div>
      <div id="seq-extra" style="margin-top:6px;"></div>
    </div>
  </div>

  <!-- P√°ginas de amor integradas -->
  <div id="love-pages-container" class="love-pages-hidden" aria-hidden="true">
    <div class="notebook-container" role="region" aria-label="Caderno de mensagens">
      <div class="notebook-page" role="document">
        <div class="lined-paper">
          <button class="close-btn" onclick="closeLovePages()" aria-label="Fechar p√°ginas">√ó</button>
          <div class="holes" aria-hidden="true">
            <div class="hole"></div>
            <div class="hole"></div>
          </div>
          <div class="content" id="page-content" role="article" aria-live="polite" tabindex="0">
            <div style="text-align:center;color:#777;">Carrega em "Amo-te Muito..." para ver as p√°ginas</div>
            <!-- Conte√∫do ser√° preenchido dinamicamente -->
          </div>
        </div>
      </div>
      <div class="navigation" role="navigation" aria-label="Navega√ß√£o de p√°ginas">
        <button onclick="previousPage()" class="nav-btn" id="prev-btn" aria-label="P√°gina anterior" tabindex="0">‚Üê Anterior</button>
        <div class="page-counter" id="page-counter" aria-live="polite">1/6</div>
        <button onclick="nextPage()" class="nav-btn" id="next-btn" aria-label="Pr√≥xima p√°gina" tabindex="0">Pr√≥xima ‚Üí</button>
      </div>
    </div>
  </div>

  <!-- Contador do pintainho: mude data-persist para "false" se quiser que reinicie a cada refresh -->
  <div id="duck-counter" class="duck-counter" role="button" aria-label="Contador do pintainho" tabindex="0" data-persist="true">
    <span class="duck-emoji" aria-hidden="true">üê•</span>
    <span id="duck-count" class="duck-count">0</span>
  </div>

  <!-- Background music element (place your MP3 at assets/audio/musica.mp3 or change the src) -->
  <audio id="bg-audio" loop preload="auto">
    <source src="assets/audio/musica.mp3" type="audio/mpeg" />
    Your browser does not support the audio element.
  </audio>
  <script defer src="script.js"></script>
  <script>
    // Anima√ß√£o de explos√£o de cora√ß√µes ao carregar
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(() => {
        const heartsContainer = document.getElementById('heartsContainer');
        
        // Criar 30 cora√ß√µes
        for (let i = 0; i < 30; i++) {
          const heart = document.createElement('div');
          heart.className = 'heart';
          heart.innerHTML = '‚ù§Ô∏è';
          
          // Posi√ß√£o aleat√≥ria na largura da tela
          heart.style.left = Math.random() * 90 + '%';
          heart.style.bottom = '0px';
          
          // Delay aleat√≥rio para cada cora√ß√£o
          heart.style.animationDelay = (Math.random() * 1.5) + 's';
          
          // Adicionar ao container
          heartsContainer.appendChild(heart);
        }
        
        // Remover container ap√≥s anima√ß√£o
        setTimeout(() => {
          heartsContainer.remove();
        }, 5000);
      }, 500);
    });

    // Contador din√¢mico: inicia em 29 de Junho do ano apropriado
    document.addEventListener('DOMContentLoaded', function () {
      const now = new Date();
      // 29 de Junho do ano corrente (mes √© 5 porque janeiro = 0)
      let startDate = new Date(now.getFullYear(), 5, 29, 0, 0, 0);
      // Se 29/06 deste ano ainda n√£o ocorreu, usa 29/06 do ano anterior
      if (startDate > now) {
        startDate = new Date(now.getFullYear() - 1, 5, 29, 0, 0, 0);
      }

      function updateCounter() {
        const now = new Date();
        let diff = now - startDate;
        if (diff < 0) diff = 0;

        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        diff -= days * (1000 * 60 * 60 * 24);
        const hours = Math.floor(diff / (1000 * 60 * 60));
        diff -= hours * (1000 * 60 * 60);
        const minutes = Math.floor(diff / (1000 * 60));
        diff -= minutes * (1000 * 60);
        const seconds = Math.floor(diff / 1000);

        const el = id => document.getElementById(id);
        if (el('days')) el('days').textContent = String(days).padStart(2, '0');
        if (el('hours')) el('hours').textContent = String(hours).padStart(2, '0');
        if (el('minutes')) el('minutes').textContent = String(minutes).padStart(2, '0');
        if (el('seconds')) el('seconds').textContent = String(seconds).padStart(2, '0');
      }

      updateCounter();
      setInterval(updateCounter, 1000);
    });
  </script>

  <!-- ...existing code de valida√ß√£o de v√≠deos... -->

  <script>
    (function(){
      let seqState = { running: false, skipped: false, currentPage: 0, pages: [] };
      const fakeNumber = 36;
      const targetPhrase = "Amo-te muito Marta/Maria";

      function setSeqHTML(html) {
        const el = document.getElementById('seq-text');
        if (el) el.innerHTML = html;
      }
      function showOverlay() {
        seqState.skipped = false;
        seqState.running = true;
        const overlay = document.getElementById('love-sequence-overlay');
        if (overlay) {
          overlay.classList.remove('hidden');
          overlay.style.display = 'flex';
          overlay.setAttribute('aria-hidden','false');
        }
      }
      function hideOverlay() {
        const overlay = document.getElementById('love-sequence-overlay');
        if (overlay) {
          overlay.classList.add('hidden');
          overlay.style.display = '';
          overlay.setAttribute('aria-hidden','true');
        }
        seqState.running = false;
      }
      window.skipSequence = function() {
        seqState.skipped = true;
      };

      function typeText(text, speed=40) {
        return new Promise(resolve=>{
          const el = document.getElementById('seq-text');
          if (!el) return resolve();
          el.textContent = '';
          let i = 0;
          (function step(){
            if (seqState.skipped) { el.textContent = text; return resolve(); }
            if (i < text.length) {
              el.textContent += text[i++];
              setTimeout(step, speed);
            } else {
              setTimeout(resolve, 500);
            }
          })();
        });
      }
      function eraseText(speed=24) {
        return new Promise(resolve=>{
          const el = document.getElementById('seq-text');
          if (!el) return resolve();
          let txt = el.textContent;
          let i = txt.length;
          (function step(){
            if (seqState.skipped) { el.textContent = ''; return resolve(); }
            if (i > 0) {
              i--;
              el.textContent = txt.slice(0,i);
              setTimeout(step, speed);
            } else resolve();
          })();
        });
      }
      async function showLines(lines) {
        const container = document.getElementById('seq-extra');
        container.innerHTML = '';
        for (let i=0;i<lines.length;i++) {
          if (seqState.skipped) {
            container.innerHTML = lines.map(l=>`<div class="seq-line show">${l}</div>`).join('');
            return;
          }
          const div = document.createElement('div');
          div.className = 'seq-line';
          div.textContent = lines[i];
          container.appendChild(div);
          requestAnimationFrame(()=> div.classList.add('show'));
          await new Promise(r=>setTimeout(r, 700));
        }
      }

      function populatePagesWithRepeats(count) {
        const perPage = 6; // linhas por p√°gina
        const pages = [];
        for (let i=0;i<count;i+=perPage) {
          const chunk = [];
          for (let j=0;j<perPage && (i+j)<count; j++) {
            chunk.push(`<div style="padding:8px 0;font-size:18px;color:#c83a6f;font-weight:600;text-align:center;">${targetPhrase}</div>`);
          }
          pages.push(`<div class="page-block">${chunk.join('')}</div>`);
        }
        seqState.pages = pages;
        seqState.currentPage = 0;
        showPage(0);
      }

      function showPage(idx) {
        const pc = document.getElementById('page-content');
        const counter = document.getElementById('page-counter');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        if (!pc) return;
        pc.innerHTML = seqState.pages[idx] || '<div style="text-align:center;color:#777;">Sem conte√∫do</div>';
        seqState.currentPage = idx;
        if (counter) counter.textContent = `${idx+1}/${Math.max(1, seqState.pages.length)}`;
        if (prevBtn) prevBtn.disabled = idx <= 0;
        if (nextBtn) nextBtn.disabled = idx >= seqState.pages.length - 1;
        setTimeout(()=> {
          const container = document.getElementById('love-pages-container');
          if (container) container.scrollIntoView({behavior:'smooth', block:'center'});
        }, 120);
      }

      // Navega√ß√£o/fecho
      window.previousPage = window.previousPage || function() {
        if (seqState.currentPage > 0) { seqState.currentPage--; showPage(seqState.currentPage); }
      };
      window.nextPage = window.nextPage || function() {
        if (seqState.currentPage < seqState.pages.length - 1) { seqState.currentPage++; showPage(seqState.currentPage); }
      };
      window.closeLovePages = window.closeLovePages || function() {
        const c = document.getElementById('love-pages-container');
        if (c) { c.classList.add('love-pages-hidden'); c.setAttribute('aria-hidden','true'); }
      };

      // Sequ√™ncia pedida: pergunta -> n√∫mero fict√≠cio -> compara√ß√µes -> mensagem fofa -> abrir p√°ginas
      window.runSequence = async function() {
        if (seqState.running) return;
        showOverlay();
        await new Promise(r => setTimeout(r, 150)); // garantir render do overlay
        // 1) Pergunta
        await typeText('Sabes quantas vezes disseste "Amo-te Muito Ivan"?', 40);
        if (seqState.skipped) { hideOverlay(); return; }
        await new Promise(r=>setTimeout(r, 450));
        await eraseText(24);
        if (seqState.skipped) { hideOverlay(); return; }
        // 2) N√∫mero fict√≠cio
        setSeqHTML(`<span class="seq-number" aria-live="polite">${fakeNumber}</span><div style="font-size:12px;color:#666;margin-top:6px;">vezes</div>`);
        const numEl = document.querySelector('.seq-number');
        if (numEl) numEl.animate([{ transform: 'scale(0.6)' }, { transform: 'scale(1.08)' }, { transform: 'scale(1)' }], { duration: 700, easing:'cubic-bezier(.2,.8,.2,1)' });
        await new Promise(r=>setTimeout(r, 900));
        if (seqState.skipped) { hideOverlay(); return; }
        // 3) Compara√ß√µes (3 linhas)
        await showLines([
          "Mais doce que chocolate quente num dia frio.",
          "Mais brilhante que a primeira estrela da noite.",
          "Mais calma que um abra√ßo ao fim do dia."
        ]);
        await new Promise(r=>setTimeout(r, 800));
        if (seqState.skipped) { hideOverlay(); return; }
        // 4) Mensagem fofa
        setSeqHTML(`<div style="font-weight:700;color:#c83a6f;">√âs o meu sorriso di√°rio üíï</div>`);
        await new Promise(r=>setTimeout(r, 1000));
        // 5) Preparar e abrir p√°ginas
        populatePagesWithRepeats(fakeNumber);
        hideOverlay();
        const container = document.getElementById('love-pages-container');
        if (container) {
          container.classList.remove('love-pages-hidden');
          container.setAttribute('aria-hidden','false');
          if (window.innerWidth <= 480) {
            setTimeout(()=> container.scrollIntoView({behavior:'smooth', block:'start'}), 80);
          }
        }
      };

      // Alias novo e expl√≠cito para iniciar sequ√™ncia (evita conflitos)
      window.openSequenceEntry = function() { runSequence(); };

      // Garantir bot√£o vis√≠vel e acess√≠vel
      document.addEventListener('DOMContentLoaded', function() {
        const btn = document.getElementById('digital-gift-btn');
        if (!btn) return;
        btn.style.display = 'block';
        btn.style.visibility = 'visible';
        btn.style.opacity = '1';
        btn.style.pointerEvents = 'auto';
        if (!btn.hasAttribute('role')) btn.setAttribute('role','button');
        if (!btn.hasAttribute('tabindex')) btn.setAttribute('tabindex','0');
        // Listener em captura: impede qualquer outro handler de abrir o caderno diretamente
        btn.addEventListener('click', function(e){
          e.preventDefault(); e.stopPropagation(); e.stopImmediatePropagation();
          window.openSequenceEntry();
        }, { capture: true });
        btn.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); window.openSequenceEntry(); }
        });
      });
    })();
  </script>

  <!-- Guard: se o bot√£o for removido/ocultado por outro script/CSS, recria e mant√©m vis√≠vel -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      function attachBtnHandlers(btn){
        // limpar onclick legado, se existir
        try { btn.onclick = null; } catch(_) {}
        btn.addEventListener('click', function(e){
          e.preventDefault(); e.stopPropagation(); e.stopImmediatePropagation();
          if (typeof window.openSequenceEntry === 'function') window.openSequenceEntry();
        }, { capture: true });
        btn.addEventListener('keydown', function(e){
          if (e.key==='Enter' || e.key===' ') {
            e.preventDefault();
            if (typeof window.openSequenceEntry === 'function') window.openSequenceEntry();
          }
        });
      }
      function ensureBtn() {
        let btn = document.getElementById('digital-gift-btn');
        if (!btn) {
          const sec = document.querySelector('section.digital-gift') || document.body;
          btn = document.createElement('div');
          btn.id = 'digital-gift-btn';
          btn.className = 'digital-gift-title clickable-title';
          btn.setAttribute('role','button');
          btn.setAttribute('tabindex','0');
          btn.textContent = 'Amo-te Muito Marta/Maria‚ù§Ô∏è';
          sec.appendChild(btn);
        }
        // for√ßar visibilidade
        btn.style.display = 'block';
        btn.style.visibility = 'visible';
        btn.style.opacity = '1';
        btn.style.pointerEvents = 'auto';
        attachBtnHandlers(btn);
      }
      ensureBtn();
      // observar remo√ß√µes/altera√ß√µes no DOM e repor o bot√£o caso desapare√ßa
      new MutationObserver(ensureBtn).observe(document.body, { childList: true, subtree: true });
    });
  </script>

  <!-- script para popular o carrossel -->
  <script>
    (function(){
      // Lista de imagens est√°ticas
      const images = [
        'assets/images/IMG_2714.jpg',
        'assets/images/WhatsApp Image 2025-10-26 at 23.23.42.jpeg',
        'assets/images/WhatsApp Image 2025-10-26 at 23.23.43 (2).jpeg',
        'assets/images/WhatsApp Image 2025-10-26 at 23.23.43 (3).jpeg',
        'assets/images/WhatsApp Image 2025-10-26 at 23.23.43.jpeg',
        'assets/images/WhatsApp Image 2025-10-26 at 23.23.46 (1).jpeg',
        'assets/images/WhatsApp Image 2025-10-26 at 23.23.46 (2).jpeg',
        'assets/images/WhatsApp Image 2025-10-26 at 23.23.46 (3).jpeg',
        'assets/images/WhatsApp Image 2025-10-26 at 23.23.46.jpeg'
      ];

      const carousel = document.getElementById('dynamic-carousel');
      if (!carousel) return;

      images.forEach((src, idx) => {
        const img = document.createElement('img');
        img.src = src;
        img.alt = `Momentos felizes ${idx+1}`;
        img.className = 'center-image carousel-image' + (idx === 0 ? ' active' : '');
        img.loading = idx === 0 ? 'eager' : 'lazy';
        img.decoding = 'async';
        img.setAttribute('fetchpriority', idx === 0 ? 'high' : 'low');
        carousel.appendChild(img);
      });
    })();
  </script>

  <!-- L√≥gica do contador do pato (sem base de dados; usa localStorage opcionalmente) -->
  <script>
    (function(){
      document.addEventListener('DOMContentLoaded', function(){
        const widget = document.getElementById('duck-counter');
        if (!widget) return;

        const countEl = document.getElementById('duck-count');
        const persistAttr = (widget.getAttribute('data-persist') || 'true') === 'true';
        const KEY = 'duckCounter:v1';
        const DAYS_KEY = 'duckCounterDays:v1';

        // iOS/Safari/WebViews podem bloquear localStorage (ex.: modo privado)
        let storageOk = false;
        let storage = null;
        try {
          storage = window.localStorage;
          const testKey = '__duck_storage_test__';
          storage.setItem(testKey, '1');
          storage.removeItem(testKey);
          storageOk = true;
        } catch (_) {
          storageOk = false;
          storage = null;
        }

        const persist = persistAttr && storageOk;

        const calGrid = document.getElementById('duck-cal-grid');
        const calTitle = document.getElementById('duck-cal-title');
        const btnPrev = document.getElementById('duck-cal-prev');
        const btnNext = document.getElementById('duck-cal-next');

        function pad2(n) { return String(n).padStart(2, '0'); }
        function toISODateLocal(d) {
          return `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;
        }

        function loadDaysMap() {
          if (!persist) return {};
          try {
            const raw = storage.getItem(DAYS_KEY);
            const obj = raw ? JSON.parse(raw) : {};
            return (obj && typeof obj === 'object') ? obj : {};
          } catch (_) {
            return {};
          }
        }

        function saveDaysMap(map) {
          if (!persist) return;
          try { storage.setItem(DAYS_KEY, JSON.stringify(map)); } catch (_) {}
        }

        let daysMap = loadDaysMap();
        let suppressNextClick = false;
        let viewYear;
        let viewMonth;
        {
          const now = new Date();
          viewYear = now.getFullYear();
          viewMonth = now.getMonth();
        }

        function renderCalendar() {
          if (!calGrid || !calTitle) return;

          const monthStart = new Date(viewYear, viewMonth, 1);
          const daysInMonth = new Date(viewYear, viewMonth + 1, 0).getDate();
          // 0=Mon ... 6=Sun
          const startOffset = (monthStart.getDay() + 6) % 7;
          const monthName = monthStart.toLocaleDateString('pt-PT', { month: 'long', year: 'numeric' });
          calTitle.textContent = monthName.charAt(0).toUpperCase() + monthName.slice(1);

          calGrid.innerHTML = '';

          for (let i = 0; i < startOffset; i++) {
            const empty = document.createElement('div');
            empty.className = 'duck-cal-cell is-empty';
            empty.setAttribute('aria-hidden', 'true');
            calGrid.appendChild(empty);
          }

          for (let day = 1; day <= daysInMonth; day++) {
            const cellDate = new Date(viewYear, viewMonth, day);
            const key = toISODateLocal(cellDate);
            const hits = daysMap[key] ? (parseInt(daysMap[key], 10) || 0) : 0;
            const capped = Math.min(9, Math.max(0, hits));

            const cell = document.createElement('div');
            cell.className = 'duck-cal-cell' + (capped > 0 ? ' has-ducks' : '') + (capped === 1 ? ' has-ducks-one' : '');
            cell.dataset.date = key;
            cell.setAttribute('role', 'gridcell');
            cell.setAttribute('tabindex', '0');
            cell.setAttribute('aria-label', capped > 0
              ? `Dia ${day}: ${capped} pintainho${capped === 1 ? '' : 's'}`
              : `Dia ${day}`);

            const dayNum = document.createElement('span');
            dayNum.className = 'duck-cal-day';
            dayNum.textContent = String(day);
            cell.appendChild(dayNum);

            if (capped > 1) {
              const badge = document.createElement('span');
              badge.className = 'duck-cal-badge';
              badge.textContent = String(capped);
              badge.setAttribute('aria-hidden', 'true');
              cell.appendChild(badge);
            }
            calGrid.appendChild(cell);
          }
        }

        let count = 0;
        if (persist) {
          let saved = null;
          try { saved = storage.getItem(KEY); } catch (_) { saved = null; }
          count = saved ? (parseInt(saved, 10) || 0) : 0;
        }

        function render() { countEl.textContent = String(count); }

        function addChickToDateKey(dateKey) {
          const prev = daysMap[dateKey] ? (parseInt(daysMap[dateKey], 10) || 0) : 0;
          if (prev >= 9) return;

          daysMap[dateKey] = prev + 1;
          saveDaysMap(daysMap);

          count++;
          if (persist) {
            try { storage.setItem(KEY, String(count)); } catch (_) {}
          }

          render();
          renderCalendar();
        }

        function resetDucks() {
          count = 0;
          if (persist) {
            try { storage.setItem(KEY, '0'); } catch (_) {}
          }
          daysMap = {};
          if (persist) {
            try { storage.removeItem(DAYS_KEY); } catch (_) {}
          }
          render();
          renderCalendar();
          try {
            widget.animate(
              [{ transform: 'scale(1)' }, { transform: 'scale(0.96)' }, { transform: 'scale(1)' }],
              { duration: 160, easing: 'ease-out' }
            );
          } catch(_) {}
        }
        function bump() {
          // marcar o dia de hoje (m√°ximo 9 por dia)
          const todayKey = toISODateLocal(new Date());
          const prev = daysMap[todayKey] ? (parseInt(daysMap[todayKey], 10) || 0) : 0;
          if (prev >= 9) return;
          addChickToDateKey(todayKey);
          try {
            widget.animate(
              [{ transform: 'scale(1)' }, { transform: 'scale(1.06)' }, { transform: 'scale(1)' }],
              { duration: 180, easing: 'ease-out' }
            );
          } catch(_) {}
        }

        render();
        renderCalendar();

        if (calGrid) {
          calGrid.addEventListener('click', (e) => {
            const cell = e.target && e.target.closest ? e.target.closest('.duck-cal-cell') : null;
            if (!cell || cell.classList.contains('is-empty')) return;
            const dateKey = cell.dataset.date;
            if (!dateKey) return;
            addChickToDateKey(dateKey);
          });

          calGrid.addEventListener('keydown', (e) => {
            if (e.key !== 'Enter' && e.key !== ' ') return;
            const cell = e.target && e.target.closest ? e.target.closest('.duck-cal-cell') : null;
            if (!cell || cell.classList.contains('is-empty')) return;
            const dateKey = cell.dataset.date;
            if (!dateKey) return;
            e.preventDefault();
            addChickToDateKey(dateKey);
          });
        }

        if (btnPrev) {
          btnPrev.addEventListener('click', () => {
            viewMonth -= 1;
            if (viewMonth < 0) { viewMonth = 11; viewYear -= 1; }
            renderCalendar();
          });
        }
        if (btnNext) {
          btnNext.addEventListener('click', () => {
            viewMonth += 1;
            if (viewMonth > 11) { viewMonth = 0; viewYear += 1; }
            renderCalendar();
          });
        }

        widget.addEventListener('click', e => {
          e.preventDefault();
          if (suppressNextClick) { suppressNextClick = false; return; }
          // Reset r√°pido (PC) com Shift+Click
          if (e.shiftKey) { resetDucks(); return; }
          bump();
        });
        widget.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); bump(); }
        });

        // Reset no telem√≥vel: pressionar e segurar
        let pressTimer = null;
        widget.addEventListener('pointerdown', e => {
          // s√≥ bot√£o principal / toque
          if (e.pointerType === 'mouse' && e.button !== 0) return;
          pressTimer = window.setTimeout(() => {
            suppressNextClick = true;
            resetDucks();
          }, 10000);
        });
        function clearPressTimer() {
          if (pressTimer) {
            window.clearTimeout(pressTimer);
            pressTimer = null;
          }
        }
        widget.addEventListener('pointerup', clearPressTimer);
        widget.addEventListener('pointercancel', clearPressTimer);
        widget.addEventListener('pointerleave', clearPressTimer);

        // Reset r√°pido com bot√£o direito (opcional)
        widget.addEventListener('contextmenu', e => {
          e.preventDefault();
          resetDucks();
        });
      });
    })();
  </script>

</body>
</html>